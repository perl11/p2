{"version":1,"ops":[{"type":1,"author":{"id":"ba1625a6608e712ded2a67f4a8029f0ddc5b0159"},"timestamp":1361763780,"metadata":{"github-id":"MDU6SXNzdWUxMTM0NjAwMQ==","github-url":"https://github.com/perl11/p2/issues/14","origin":"github"},"title":"stack-buffer-underflow at 3nd call op test/flow/except.pn","message":"-B and -X\n\n```\n$ ./potion -V -B test/flow/except.pn  2\u003e\u00261 |less\n[21] loadpn   0 3       ; 1\n[22] move     1 0       ; 1\n[23] loadk    0 3       ; to\n[24] message  0 1       ; function(end)\n[25] loadpn   2 5       ; 2\n[26] proto    3 4       ; function(x)\n[29] call     0 3-- run-time --\n[ 1] getupval 0 0       ; function(block, catch)\n[ 2] self     1 ; Lobby\n[ 3] proto    2 0       ; function()\n[ 6] proto    3 1       ; function(e)\n[ 7] call     0 3-- run-time --\n[ 1] newtuple 0 0       ; ()\n[ 2] setlocal 0 2       ; ()\n[ 3] self     1 ; Lobby\n[ 4] loadk    0 0       ; here\n[ 5] bind     0 1       ; function()\n[ 6] loadpn   2 0       ; nil\n[ 7] call     0 2=================================================================\n==30674== ERROR: AddressSanitizer: stack-buffer-underflow on address 0x7fff7c3e39a0 at pc 0x40d876 bp 0x7fff7c3e2e60 sp 0x7fff7c3e2620\nREAD of size 1 at 0x7fff7c3e39a0 thread T0\n    #0 0x40d875 in __interceptor_memcpy (/home/rurban/Perl/p2/p2/potion+0x40d875)\n    #1 0x7fa33b13d735 in potion_callcc (./libpotion.so+0xd6735)\n    #2 0x7fa33b1dae61 in potion_call /usr/src/p2/p2/core/internal.c:130\n    #3 0x7fa33b272cc8 in potion_vm /usr/src/p2/p2/core/vm.c:435\n    #4 0x7fa33b263630 in potion_vm_proto /usr/src/p2/p2/core/vm.c:74\n    #5 0x7fa33b1f2c3a in potion_num_to /usr/src/p2/p2/core/number.c:119\n    #6 0x7fa33b1db10c in potion_call /usr/src/p2/p2/core/internal.c:132\n    #7 0x7fa33b272cc8 in potion_vm /usr/src/p2/p2/core/vm.c:435\n    #8 0x41e4e8 in potion_cmd_compile /usr/src/p2/p2/front/potion.c:106\n    #9 0x41c5f5 in main /usr/src/p2/p2/front/potion.c:240\n    #10 0x7fa33a443eac (/lib/x86_64-linux-gnu/libc.so.6+0x1eeac)\nAddress 0x7fff7c3e39a0 is located at offset 0 in frame \u003cpotion_call\u003e of T0's stack:\n  This frame has 6 object(s):\n    [32, 40) 'retval'\n    [96, 104) 'P.addr'\n    [160, 168) 'cl.addr'\n    [224, 228) 'argc.addr'\n    [288, 296) 'argv.addr'\n    [352, 360) 'c'\n#1  0x000000000040d8a4 in memcpy ()\n#2  0x00007ffff7bf3f06 in potion_callcc () from ./libpotion.so\n#3  0x00007ffff7c91652 in potion_call (P=0x7ffff7f70060, cl=140737353594048, argc=2, argv=0x7ffffffe8e00)\n    at core/internal.c:130\n#4  0x00007ffff7d294b9 in potion_vm (P=0x7ffff7f70060, proto=140737352523328, self=140737353581352, \n    vargs=140737352290536, upc=0, upargs=0x7ffff7e3cf30) at core/vm.c:435\n#5  0x00007ffff7d19e21 in potion_vm_proto (P=0x7ffff7f70060, cl=140737352290392, self=140737353581352)\n    at core/vm.c:74\n#6  0x00007ffff7ca942b in potion_num_to (P=0x7ffff7f70060, cl=140737353601704, self=3, end=5, \n    block=140737352290392) at core/number.c:119\n#7  0x00007ffff7c918fd in potion_call (P=0x7ffff7f70060, cl=140737353601704, argc=3, argv=0x7fffffff52e0)\n    at core/internal.c:132\n```","files":null}]}